# devtools-db4j

<code>devtools-db4j</code> is a simple and practical JDBC tool library, which provides varied high level API to operation database, thereby increasing developing efficiency

## Install

``` xml
<dependency>
	<groupId>com.github.paganini2008</groupId>
	<artifactId>devtools-db4j</artifactId>
	<version>2.0.5</version>
</dependency>
```

## Core API

* SqlPlus
* SqlRunner
* ParsedSqlRunner
* TypeHandler
* TypeHandlerRegistry
* ResultSetExtractor
* RowMapper

## Quick Start

Example 1: 

``` java
    /**
	 * Insert, Update, Delete in a transaction
	 * 
	 * @throws SQLException
	 */
	public static void testUpdateInTransaction() throws SQLException {
		String driverClassName = "com.mysql.cj.jdbc.Driver";
		String jdbcUrl = "jdbc:mysql://localhost:3306/test?userUnicode=true&characterEncoding=UTF8&useSSL=false&serverTimezone=UTC&autoReconnect=true&zeroDateTimeBehavior=convertToNull";
		String user = "fengy";
		String password = "123456";
		SqlPlus sqlPlus = new SqlPlus(driverClassName, jdbcUrl, user, password);
		Transaction transaction = null;
		try {
			transaction = sqlPlus.beginTransaction(); // Open transaction
			GeneratedKey generatedKey = GeneratedKey.autoGenerated();

			Point point = new Point();// Pojo
			point.setUsername("tester-14");
			point.setPoints(100);
			point.setTag(5);
			point.setDate(new Date());
			int effectedRows = transaction.update(
			"insert into tb_point (username,points,tag,last_modified) values ({username},{points},{tag},{date})", new BeanPropertySqlParameter(point), generatedKey); // bean mapping
			System.out.println("EffectedRows: " + effectedRows);
			System.out.println("Added id: " + generatedKey.getKey());

			Map<String, Object> parameterMap = new HashMap<String, Object>();
			parameterMap.put("points", 10);
			parameterMap.put("username", "tester-12");
			effectedRows = transaction.update("update tb_point set points=points+{points} where username={username}", new MapSqlParameter(parameterMap)); // Map mapping
			System.out.println("EffectedRows: " + effectedRows);

			//effectedRows = transaction.update("delete from tb_point where username!={0}", new ArraySqlParameter("tester-12")); // Array mapping
			//System.out.println("EffectedRows: " + effectedRows);
			transaction.commit();
		} catch (SQLException e) {
			transaction.rollback();
			throw e;
		} finally {
			transaction.close(); // Transaction end
		}
	}

	/**
	 * Query for List
	 * 
	 * @throws SQLException
	 */
	public static void testQuery() throws SQLException {
		String driverClassName = "com.mysql.cj.jdbc.Driver";
		String jdbcUrl = "jdbc:mysql://localhost:3306/test?userUnicode=true&characterEncoding=UTF8&useSSL=false&serverTimezone=UTC&autoReconnect=true&zeroDateTimeBehavior=convertToNull";
		String user = "fengy";
		String password = "123456";
		SqlPlus sqlPlus = new SqlPlus(driverClassName, jdbcUrl, user, password);
		List<Tuple> dataList = sqlPlus.queryForList("select * from tb_point", new Object[0]);
		dataList.forEach(tuple -> {
			System.out.println(tuple);
		});

	}

	/**
	 * Pageable Query
	 * 
	 * @throws SQLException
	 */
	public static void testPageableQuery() throws SQLException {
		String driverClassName = "com.mysql.cj.jdbc.Driver";
		String jdbcUrl = "jdbc:mysql://localhost:3306/test?userUnicode=true&characterEncoding=UTF8&useSSL=false&serverTimezone=UTC&autoReconnect=true&zeroDateTimeBehavior=convertToNull";
		String user = "fengy";
		String password = "123456";
		SqlPlus sqlPlus = new SqlPlus(driverClassName, jdbcUrl, user, password);
		PageableQuery<Tuple> pageableQuery = sqlPlus.queryForPage("select * from tb_point where points>{0}", new Object[] { 10 });
		for (PageResponse<Tuple> pageResponse : pageableQuery.forEach(1, 10)) {// Page start from 1
			System.out.println("Page: " + pageResponse.getPageNumber());
			pageResponse.getContent().forEach(tuple -> {
				System.out.println(tuple); // Iterator each record
			});
		}
	}
```



Example 2:

``` java
private static Connection getConnection() throws SQLException {
		String jdbcUrl = "jdbc:mysql://localhost:3306/test?userUnicode=true&characterEncoding=UTF8&useSSL=false&serverTimezone=UTC&autoReconnect=true&zeroDateTimeBehavior=convertToNull";
		String user = "fengy";
		String password = "123456";
		return DriverManager.getConnection(jdbcUrl, user, password);
	}

	public static void test1() throws SQLException {
		ParsedSqlRunner sqlRunner = new ParsedSqlRunner();
		Connection connection = getConnection();
		List<Tuple> list = sqlRunner.queryForList(connection, "select * from ccms_param limit 100",
				new Object[] { RandomUtils.randomInt(1, 4) });
		for (Tuple tuple : list) {
			System.out.println(tuple);
		}
		System.out.println("Total rows: " + list.size());
		JdbcUtils.closeQuietly(connection);
	}

	public static void test2() throws SQLException {
		ParsedSqlRunner sqlRunner = new ParsedSqlRunner();
		Connection connection = getConnection();
		Cursor<Tuple> cursor = sqlRunner.queryForCursor(connection, "select * from crawler_resources limit 1000");
		while (cursor.hasNext()) {
			Tuple tuple = cursor.next();
			System.out.println(cursor.getRownum() + ": " + tuple.get("title") + "\t" + tuple.get("url"));
		}
		cursor.close();
		JdbcUtils.closeQuietly(connection);
	}

	public static void test3() throws SQLException {
		ParsedSqlRunner sqlRunner = new ParsedSqlRunner();
		Connection connection = getConnection();
		Cursor<Tuple> cursor = sqlRunner.queryForCachedCursor(connection, "select * from crawler_resources limit 100");
		while (cursor.hasNext()) {
			Tuple tuple = cursor.next();
			System.out.println(tuple.get("title") + "\t" + tuple.get("url"));
		}
		cursor.close();
		JdbcUtils.closeQuietly(connection);
	}

```

